<script>
  const wrap = document.getElementById('scrollWrap');
  const thumb = document.getElementById('thumb');
  const scrollbar = document.querySelector('.scrollbar');
  let dragging = false;

  // update orb position
  function updateThumb() {
    const maxScroll = wrap.scrollWidth - wrap.clientWidth;
    const scrollRatio = wrap.scrollLeft / maxScroll;
    const trackWidth = scrollbar.clientWidth;
    thumb.style.left = scrollRatio * trackWidth + 'px';
  }
  wrap.addEventListener('scroll', updateThumb);
  window.addEventListener('resize', updateThumb);
  updateThumb();

  // drag orb to scroll
  thumb.addEventListener('mousedown', e => { dragging = true; e.preventDefault(); });
  window.addEventListener('mouseup', () => dragging = false);
  window.addEventListener('mousemove', e => {
    if (!dragging) return;
    const rect = scrollbar.getBoundingClientRect();
    let x = e.clientX - rect.left;
    x = Math.max(0, Math.min(rect.width, x));
    thumb.style.left = x + 'px';
    const ratio = x / rect.width;
    wrap.scrollLeft = ratio * (wrap.scrollWidth - wrap.clientWidth);
  });

  // map trackpad + mouse wheel to horizontal
  wrap.addEventListener('wheel', e => {
    wrap.scrollLeft += (Math.abs(e.deltaX) > Math.abs(e.deltaY) ? e.deltaX : e.deltaY);
  });

  // mouse position → subtle rotate models
  document.addEventListener('mousemove', e => {
    const xRatio = e.clientX / window.innerWidth;  // 0 (left) → 1 (right)
    const yRatio = e.clientY / window.innerHeight; // 0 (top) → 1 (bottom)

    // Map ratios to constrained ranges
    const yawRange = 45;   // limit left/right to ±45°
    const pitchRange = 20; // limit up/down to ±20°

    const yaw = (xRatio - 0.5) * 2 * yawRange;    // -45 → 45
    const pitch = (0.5 - yRatio) * 2 * pitchRange; // -20 → 20

    document.querySelectorAll('model-viewer').forEach(mv => {
      mv.cameraOrbit = `${yaw}deg ${pitch}deg auto`;
    });
  });

  // clicking a model still follows link
  document.querySelectorAll('.card model-viewer').forEach(mv => {
    mv.addEventListener('click', e => {
      const parentLink = mv.closest('a');
      if (parentLink) window.open(parentLink.href, parentLink.target || '_self');
    });
  });
</script>
